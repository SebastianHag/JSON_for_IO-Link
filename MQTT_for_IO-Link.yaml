asyncapi: 2.3.0
info:
  title: MQTT for IO-Link Topics
  version: 0.0.1
  description: >
    This is the _AsyncAPI_ specification of MQTT topics by the IO-Link consortium.
  termsOfService: 'https://www.io-link.com'
  contact:
    name: Markus Rentschler
    email: markus.rentschler@murrelektronik.de
servers:
  broker:
    url: 'api.iolink.com:{port}'
    protocol: mqtt
    description: central mqtt Broker
    security:
      - user-password: []
    variables:
      port:
        enum:
          - '1883'
          - '8883'
        default: '1883'
channels:
  '{originatorId}/connection':
    description: >-
      Topic that publishes online/offline state of the gateway, send at
      startup/"birth" and as "lastwill"
    parameters:
      originatorId:
        description: >-
          shall be the unique identifier of the originator and shall correspond
          to the client id inside the MQTT message. It can be the ProductURI,
          DNS name, IP address or MAC address of the device hosting the MQTT
          publisher. By default the Hostname shall be used.
        schema:
          type: string
          example: iomaster_nr1
      deviceId:
        description: 'Id of the device (e.g.  (i.e. an IO-Link device, an IO-Port number)'
        schema:
          type: string
          example: port1
    subscribe:
      message:
        $ref: '#/components/messages/connection'
      bindings:
        mqtt:
          qos: 1
          retain: true
  '{originatorId}/asset':
    description: >-
      publishes asset (e.g. gateway) nameplate information, send at startup or
      onChange
    parameters:
      originatorId:
        description: >-
          shall be the unique identifier of the originator and shall correspond
          to the client id inside the MQTT message. It can be the ProductURI,
          DNS name, IP address or MAC address of the device hosting the MQTT
          publisher. By default the Hostname shall be used.
        schema:
          type: string
          example: iomaster_nr1
    subscribe:
      message:
        $ref: '#/components/messages/nameplate'
      bindings:
        mqtt:
          qos: 1
          retain: true
  '{originatorId}/health':
    description: publishes gateway health state
    parameters:
      originatorId:
        description: >-
          shall be the unique identifier of the originator and shall correspond
          to the client id inside the MQTT message. It can be the ProductURI,
          DNS name, IP address or MAC address of the device hosting the MQTT
          publisher. By default the Hostname shall be used.
        schema:
          type: string
          example: iomaster_nr1
    subscribe:
      message:
        $ref: '#/components/messages/gatewayhealth'
      bindings:
        mqtt:
          qos: 1
          retain: true
  '{originatorId}/{deviceId}(/event)/asset':
    description: >-
      publishes asset (e.g. device) nameplate information, send at connection
      startup (new connection)
    parameters:
      originatorId:
        description: >-
          shall be the unique identifier of the originator and shall correspond
          to the client id inside the MQTT message. It can be the ProductURI,
          DNS name, IP address or MAC address of the device hosting the MQTT
          publisher. By default the Hostname shall be used.
        schema:
          type: string
          example: iomaster_nr1
      deviceId:
        description: 'Id of the device (e.g.  (i.e. an IO-Link device, an IO-Port number)'
        schema:
          type: string
          example: port1
    subscribe:
      message:
        $ref: '#/components/messages/nameplate_iolink'
      bindings:
        mqtt:
          qos: 1
          retain: true
  '{originatorId}/{deviceId}(/event)/status':
    description: 'publishes the port status, send at startup/onChange'
    parameters:
      originatorId:
        description: >-
          shall be the unique identifier of the originator and shall correspond
          to the client id inside the MQTT message. It can be the ProductURI,
          DNS name, IP address or MAC address of the device hosting the MQTT
          publisher. By default the Hostname shall be used.
        schema:
          type: string
          example: iomaster_nr1
      deviceId:
        description: 'Id of the device (e.g.  (i.e. an IO-Link device, an IO-Port number)'
        schema:
          type: string
          example: port1
    subscribe:
      message:
        $ref: '#/components/messages/portstatus'
      bindings:
        mqtt:
          qos: 1
          retain: true
  '{originatorId}/{deviceId}(/event)/health':
    description: health data of the device
    parameters:
      originatorId:
        description: >-
          shall be the unique identifier of the originator and shall correspond
          to the client id inside the MQTT message. It can be the ProductURI,
          DNS name, IP address or MAC address of the device hosting the MQTT
          publisher. By default the Hostname shall be used.
        schema:
          type: string
          example: iomaster_nr1
      deviceId:
        description: 'Id of the device (e.g.  (i.e. an IO-Link device, an IO-Port number)'
        schema:
          type: string
          example: port1
    subscribe:
      message:
        $ref: '#/components/messages/devicehealth'
      bindings:
        mqtt:
          qos: 1
          retain: true
  '{originatorId}/{deviceId}/processData':
    parameters:
      originatorId:
        description: >-
          shall be the unique identifier of the originator and shall correspond
          to the client id inside the MQTT message. It can be the ProductURI,
          DNS name, IP address or MAC address of the device hosting the MQTT
          publisher. By default the Hostname shall be used.
        schema:
          type: string
          example: iomaster_nr1
      deviceId:
        description: 'Id of the device (e.g.  (i.e. an IO-Link device, an IO-Port number)'
        schema:
          type: string
          example: port1
    subscribe:
      message:
        oneOf:
          - $ref: '#/components/messages/processdata_IOLink'
          - $ref: '#/components/messages/processdata_Misc'
      bindings:
        mqtt:
          qos: 1
          retain: true
  '{originatorId}/{deviceId}/events':
    description: >-
      eventlog of the io link device, see
      "iolink/v1/devices/{deviceAlias}/events"
    parameters:
      originatorId:
        description: >-
          shall be the unique identifier of the originator and shall correspond
          to the client id inside the MQTT message. It can be the ProductURI,
          DNS name, IP address or MAC address of the device hosting the MQTT
          publisher. By default the Hostname shall be used.
        schema:
          type: string
          example: iomaster_nr1
      deviceId:
        description: 'Id of the device (e.g.  (i.e. an IO-Link device, an IO-Port number)'
        schema:
          type: string
          example: port1
    subscribe:
      message:
        $ref: '#/components/messages/deviceEvents'
      bindings:
        mqtt:
          qos: 1
          retain: true
components:
  messages:
    connection:
      summary: onlinestate of the gateway
      description: This will be issued as birth and lastwill message.
      tags:
        - name: gateway
      payload:
        type: string
        enum:
          - online
          - offline
        example: online
    nameplate:
      summary: contains the nameplate information of a gateway.
      tags:
        - name: gateway
      payload:
        type: object
        properties:
          vendorName:
            type: string
            default: Murrelektronik"
          vendorId:
            type: number
            default: 303
          vendorUrl:
            type: string
            format: url
            default: 'http://www.murrelektronik.com'
          productName:
            type: string
            example: Impact67 PN DIO12 IOL4 IRT 7/8" 5pin
          orderCode:
            type: string
            example: 55132
          serialNumber:
            type: string
            example: 1234567
          productUri:
            type: string
            format: url
            description: >-
              Unique product identifier and link to product catalogue
              (https://product.murrelektronik.com/{productCode}/{orderCode}/{serialNumber})
            example: 'https://product.murrelektronik.com/XYZ/512345/01234567'
          hardwareRevision:
            type: string
            example: 7
          softwareRevision:
            type: string
            example: 1.2.3
          deviceClass:
            type: string
            example: PN Profinet
          nameOfStation:
            type: string
            description: Profinet station name
            example: profinetstation
          sysName:
            type: string
            description: Systemname
            example: Device_123
          sysContact:
            type: string
            description: contact person (eMail) for this device or system
            example: service@murrelektronik.de
          sysLocation:
            type: string
            description: Location description of the device or system
            example: Factory ABC Hall 123
          ethIpv4:
            $ref: './schemas.yaml#/networkConfiguration'
    gatewayhealth:
      summary: diagnostic health information of the gateway.
      tags:
        - name: gateway
      payload:
        type: object
        required:
          - health
          - healthState
        properties:
          error:
            type: string
            description: Error message describing the error ocurred.
          health:
            $ref: './schemas.yaml#/namurHealth'
          healthState:
            $ref: './schemas.yaml#/namurHealthState'
        example:
          health: NORMAL_0
          healthState: 100
    portstatus:
      summary: contains the status of the port.
      tags:
        - name: gateway
      payload:
        type: object
        required:
          - portNumber
          - maxPowerSupply
          - portType
          - mode
          - deviceAlias
          - iqConfiguration
        properties:
          portNumber:
            type: number
            example: 1
          maxPowerSupply:
            type: object
            required:
              - value
              - unit
            properties:
              value:
                type: number
                example: 0.3
              unit:
                type: string
                example: A
          portType:
            type: string
            enum:
              - CLASS_A
              - CLASS_B
              - CLASS_A_WITH_PORT_POWER_OFF_ON
              - FAILSAFE_PORT_A_WITHOUT_SAFETY_DIGITAL_INPUTS
              - FAILSAFE_PORT_A_WITH_SAFETY_DIGITAL_INPUTS
              - FAILSAFE_PORT_B
              - WIRELESS_MASTER
            example: CLASS_A
          mode:
            type: string
            enum:
              - DEACTIVATED
              - IOLINK_MANUAL
              - IOLINK_AUTOSTART
              - DIGITAL_INPUT
              - DIGITAL_OUTPUT
            example: DEACTIVATED
          deviceAlias:
            type: string
            example: master1port1
          iqConfiguration:
            type: string
            enum:
              - NOT_SUPPORTED
              - DIGITAL_INPUT
              - DIGITAL_OUTPUT
            example: DIGITAL_INPUT
          validationAndBackup:
            type: string
            description: Used by the IO-Link Master just when portMode is IOLINK_MANUAL.
            enum:
              - NO_DEVICE_CHECK
              - TYPE_COMPATIBLE_DEVICE_V1.0
              - TYPE_COMPATIBLE_DEVICE_V1.1
              - TYPE_COMPATIBLE_DEVICE_V1.1_BACKUP_AND_RESTORE
              - TYPE_COMPATIBLE_DEVICE_V1.1_RESTORE
            example: NO_DEVICE_CHECK
          cycleTime:
            description: >-
              Used by the IO-Link Master just when portMode is IOLINK_MANUAL or
              IOLINK_AUTOSTART. Default value is 0 ms which means as fast as
              possible
            type: object
            required:
              - value
              - unit
            properties:
              value:
                type: number
                example: 2.3
              unit:
                type: string
                enum:
                  - ms
                example: ms
          vendorId:
            type: integer
            minimum: 1
            maximum: 65535
            description: >-
              Used by the IO-Link Master just when portMode is IOLINK_MANUAL and
              validationAndBackup is not NO_DEVICE_CHECK.
            example: 1234
          deviceId:
            type: integer
            minimum: 1
            maximum: 16777215
            description: >-
              Used by the IO-Link Master just when portMode is IOLINK_MANUAL and
              validationAndBackup is not NO_DEVICE_CHECK.
            example: 15464
    nameplate_iolink:
      summary: contains the nameplate information of an IO-Link device.
      description: |
        This will be issued when an IO-Link device was detected.
      tags:
        - name: device
      payload:
        type: object
        properties:
          vendorName:
            type: string
            default: Murrelektronik
          vendorId:
            type: number
            default: 303
          vendorUrl:
            type: string
            format: url
            default: 'http://www.murrelektronik.com'
          productName:
            type: string
          orderCode:
            type: string
          serialNumber:
            type: string
          productUri:
            type: string
            format: url
            description: >-
              Unique identifier and link to product catalogue
              (https://product.murrelektronik.com/{productCode}/{orderCode}/{serialNumber})
          hardwareRevision:
            type: string
          firmwareRevision:
            type: string
        example:
          vendorName: Murrelektronik
          vendorId: 303
          vendorUrl: 'http://www.murrelektronik.com/'
          orderCode: 55132
          productName: Impact67 PN DIO12 IOL4 IRT 7/8" 5pin
          serialNumber: '123456789'
          hardwareRevision: 1.0.0
          softwareRevision: 1.0.1
    devicehealth:
      summary: contains the health information of the device.
      tags:
        - name: device
      payload:
        required:
          - health
          - healthState
        type: object
        properties:
          health:
            $ref: './schemas.yaml#/namurHealth'
          healthState:
            $ref: './schemas.yaml#/namurHealthState'
          errors:
            type: object
            properties:
              iolErrors:
                type: object
                properties:
                  isIolWirebreak:
                    type: boolean
                  isIolShortCircuit:
                    type: boolean
                  isProcessDataInvalid:
                    type: boolean
                  isDataStorageFaulty:
                    type: boolean
                  isValidationFailure:
                    type: boolean
                  validationError:
                    type: object
                    properties:
                      isWrongCycleTime:
                        type: boolean
                      isWrongIolinkRevision:
                        type: boolean
                      isWrongPdInLength:
                        type: boolean
                      isWrongPdOutLength:
                        type: boolean
                      isWrongVendorId:
                        type: boolean
                      isWrongDeviceId:
                        type: boolean
                      isWrongSerialNumber:
                        type: boolean
              isShortCircuitPin4:
                type: boolean
              isShortCircuitPin2:
                type: boolean
              isOverloadStatusPin4:
                type: boolean
              isOverloadStatusPin2:
                type: boolean
              isActuatorWarningPin4:
                type: boolean
              isActuatorWarningPin2:
                type: boolean
    deviceEvents:
      summary: events
      tags:
        - name: device
      payload:
        $ref: './schemas.yaml#/deviceEventsGet'
    processdata_IOLink:
      summary: >-
        Read the process data values (input and output) from the specified
        Device
      tags:
        - name: device
      payload:
        $ref: './schemas.yaml#/deviceProcessDataValueGet'
    processdata_Misc:
      summary: >-
        Read the process data values (input and output) from the specified
        Device.
      tags:
        - name: device
      payload:
        $ref: './schemas.yaml#/deviceProcessDataValueMisc'
  parameters:
    originatorId:
      description: >-
        This is the unique identifier of the originator and shall correspond to
        the client id inside the MQTT message. It can be the ProductURI, DNS
        name, IP address or MAC address of the device hosting the MQTT
        publisher. By default the Hostname shall be used.
      schema:
        type: string
        example: iomaster_nr1
    deviceId:
      description: Id of the IO-Link device (e.g. port nr)
      schema:
        type: string
        example: port1
  securitySchemes:
    user-password:
      type: userPassword
